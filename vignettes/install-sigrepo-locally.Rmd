---
title: "Install Sigrepo Locally"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Install Sigrepo Locally}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

## Software requirements

- Git version >= 2.21
- Docker version >= 20.10

Don't have Git installed, see [Git Guides](https://github.com/git-guides/install-git)

Don't have Docker installed, download a [Docker Engine](https://docs.docker.com/engine/install/) that is compatible with your machine

**NOTE:** may need to restart your computer for Docker to kicks-in

- Check if Docker is installed 

```bash
docker --version
```

- Check if Docker Compose is installed

```bash
docker compose version
```

## Set-up

1. Clone this repository and navigate to **SigRepo** folder

```bash
git clone https://github.com/montilab/SigRepo
cd SigRepo
```

2. Create a **mysql.env** file to initiate database and users in MySQL database

```text
MYSQL_DATABASE='sigrepo'
MYSQL_USER='admin'
MYSQL_PASSWORD='admin'
MYSQL_ROOT_PASSWORD='123456'
```

3. Create a MySQL directory to store database tables and schemas

```bash
mkdir /montilab-p/mysql/database
```

4. Create a network **db-net** to host MySQL locally

```bash
docker network create -d bridge db-net
```

5. Edit **docker-compose.yml** to configure how to build MySQL database, RStudio Server, and Sigrepo Shiny images and containers.

```text
services:
  sigrepo-mysql:
    container_name: sigrepo-mysql
    image: sigrepo-mysql:latest
    build:
      context: .
      dockerfile: Dockerfile-mysql
      args:
        - mysql_image=mysql:8.0-bookworm
    env_file:
      - mysql.env
    volumes:
      - /montilab-p/mysql/database:/var/lib/mysql:rw
      - /montilab-p/SigRepo/inst/mysql/schema/init.sql:/docker-entrypoint-initdb.d/init.sql:rw
    networks:
      - db-net
    ports:
      - 3306:3306
    restart: always

networks:
  db-net:
    external: true
```

6. Start MySQL database, RStudio Server, and Sigrepo Shiny containers

```bash
docker compose up -d
```

**`-d`**: run container in detached mode <br>

7. Inspect mysql container to get network IP address to establish connection locally

```bash
docker inspect -f '{{range .NetworkSettings.Networks}}{{.IPAddress}}{{end}}' sigrepo-mysql
```

For example: 172.18.0.3

8. Create an **.Renviron** file and store it in your **$HOME** or Project directory in order to retrieve credentials to log into MySQL server

```text
DBNAME = "sigrepo"
HOST = "172.18.0.3"
PORT = 3306
USER = "root"
PASSWORD = "123456"
```

9. Connect to MySQL server from your local RStudio Server

```
# For DB connection
library(RMySQL)
library(DBI)

## Establish database connection
conn <- DBI::dbConnect(
  drv = RMySQL::MySQL(),
  dbname = Sys.getenv("DBNAME"), 
  host = Sys.getenv("HOST"), 
  port = as.integer(Sys.getenv("PORT")), 
  user = Sys.getenv("USER"), 
  password = Sys.getenv("PASSWORD")
)
```
